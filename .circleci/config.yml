version: 2
jobs:
  tox:
    docker:
      - image: themattrix/tox
    environment:
      AWS_DEFAULT_REGION: "us-west-2"
    working_directory: ~/ssm_parameter_store
    steps:
      - checkout
      - attach_workspace:
          at: ~/ssm_parameter_store
      - run: tox
      - persist_to_workspace:
          root: .
          paths:
            - .coverage*
            - .tox
  codecov:
    machine:
      enabled: true
    working_directory: ~/ssm_parameter_store
    steps:
      - checkout
      - attach_workspace:
          at: ~/ssm_parameter_store
      - run: |
          pip install coverage codecov
          coverage combine
          codecov
workflows:
  version: 2
  btd:
    jobs:
      - tox
      - codecov:
          requires:
            - tox
